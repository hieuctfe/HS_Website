@model PropertyPageViewModels
@{
    ViewBag.Title = "Danh Sách Dự Án";

    string action = ViewContext.RouteData.Values["action"].ToString(),
           controller = ViewContext.RouteData.Values["controller"].ToString(),
           searchPrefix = $"{nameof(Model.PropertyPagination)}.";

    var routeValues = new RouteValueDictionary
    {
        [$"{searchPrefix}SortField"] = Request[$"{searchPrefix}SortField"],
        [$"{searchPrefix}PageIndex"] = Request[$"{searchPrefix}PageIndex"],
        [$"{searchPrefix}PageSize"] = Request[$"{searchPrefix}PageSize"],
        [$"{searchPrefix}AreaValue"] = Request[$"{searchPrefix}AreaValue"],
        [$"{searchPrefix}FromPriceValue"] = Request[$"{searchPrefix}FromPriceValue"],
        [$"{searchPrefix}ToPriceValue"] = Request[$"{searchPrefix}ToPriceValue"],
        [$"{searchPrefix}City"] = Request[$"{searchPrefix}City"],
        [$"{searchPrefix}District"] = Request[$"{searchPrefix}District"],
        [$"{searchPrefix}Status"] = Request[$"{searchPrefix}Status"],
        [$"{searchPrefix}Type"] = Request[$"{searchPrefix}Type"],
        [$"{searchPrefix}Bed"] = Request[$"{searchPrefix}Bed"],
        [$"{searchPrefix}Bath"] = Request[$"{searchPrefix}Bath"],
        [$"{searchPrefix}Bath"] = Request[$"{searchPrefix}Bath"],
        ["typeId"] = Request["typeId"],
        ["statusId"] = Request["statusId"],
    };
}
@section CustomStyles
{
    <link href="@Url.AppVendors("bootstrap-touchspin/dist/jquery.bootstrap-touchspin.min.css")" rel="stylesheet" />
    <style>
        .quantity > ul > li {
            text-align:center;
        }

        .bootstrap-touchspin-prefix {
            padding: 5px;
        }

        #@nameof(Model.PropertyPagination.FromPriceValue),
        #@nameof(Model.PropertyPagination.ToPriceValue),
        #searchBoxBath,
        #searchBoxBed
        {
            min-height:38px;
            margin-bottom:0px;
        }
    </style>
}
@section CustomScripts
{
    <script src="@Url.AppVendors("bootstrap-touchspin/dist/jquery.bootstrap-touchspin.js")" type="text/javascript"></script>
    <script type="text/javascript">
        $('input#FromPriceValue').TouchSpin({
            min: 0,
            max: 999999999999,
            prefix: 'Từ &nbsp;',
            initval: "",
            step: 500000,
            forcestepdivisibility: 'none',
            verticalbuttons: true,
            buttonup_class: 'btn btn-secondary',
            buttondown_class: 'btn btn-default'
        });

        $('input#ToPriceValue').TouchSpin({
            min: 0,
            max: 999999999999,
            prefix: 'Đến ',
            initval: "",
            step: 500000,
            forcestepdivisibility: 'none',
            verticalbuttons: true,
            buttonup_class: 'btn btn-secondary',
            buttondown_class: 'btn btn-default'
        });

        $(".area_filter").slider({
            from: 0,
            to: 1000,
            step: 10,
            smooth: true,
            round: 0,
            dimension: "m²",
            skin: "plastic"
        });

        $('input#searchBoxBed').TouchSpin({
            min: 0,
            max: 9,
            prefix: '<i class="fa fa-bed"></i>',
            buttonup_class: 'btn btn-secondary',
            buttondown_class: 'btn btn-default',
            verticalbuttons: true
        });

        $('input#searchBoxBath').TouchSpin({
            min: 0,
            max: 9,
            prefix: '<i class="fa fa-bath"></i>',
            buttonup_class: 'btn btn-secondary',
            buttondown_class: 'btn btn-default',
            verticalbuttons: true
        });

        $(function () {
            var $city = $('#@nameof(Model.PropertyPagination.City)');
            var $district = $('#@nameof(Model.PropertyPagination.District)');

            $city.on('change', function () {
                let $this = $(this);
                let options = `<option value="">@Html.DisplayNameFor(x => x.PropertyPagination.District)</option>`;
                if ($this.val() === '') {
                    $district.prop('disabled', true);
                    $district.empty();
                    $district.html(options);
                    $district.selectpicker('refresh');
                } else {
                    $.ajax({
                        url: '@Url.Action("GetDistricts")',
                        dataType: 'json',
                        method: 'get',
                        data: {
                            cityName: $this.val()
                        }
                    }).done(function (data) {
                        $district.prop('disabled', false);

                        $.each(data, function (i, ele) {
                            options += `<option value="${ele}">${ele}</option>`;
                        });
                        $district.empty();
                        $district.html(options)
                        $district.selectpicker('refresh');
                    }).fail(function () {
                        swal('Error at loading districts, Please contact to the administrator', '', 'error');
                    });
                }
            });

            var $orderBy = $('#@nameof(Model.PropertyPagination.SortField)');

            $orderBy.on('change', function () {
                let $this = $(this);
                let $form = $('#searchForm');

                $('<input />').attr('type', 'hidden')
                    .attr('name', "@($"{searchPrefix}{nameof(Model.PropertyPagination.SortField)}")")
                    .attr('value', $this.val())
                    .appendTo($form);
                $form.submit();
            });
        });

        $('.tooltip-ac').tooltip();
    </script>
}
@{ Html.RenderPartial($"_Banner_Section"); }

<!-- Property List Start -->
<section id="property_area">
    <div class="" style="padding-left:15px">
        <div class="row">
            @{
                Model.PropertyPagination.Prefix = searchPrefix;
            }
            <div class="col-md-2">
                @{ Html.RenderPartial($"_Search_Sidebar", Model); }
                @{ Html.RenderPartial("_Team_Sidebar", (string)ViewBag.TeamUI); }
            </div>
            <div class="col-md-7">
                @{ Html.RenderPartial($"_Top_Sidebar", Model.PropertyPagination); }
                <!-- Property List Start -->
                <div class="row">
                    @foreach (var prop in Model.Properties)
                    {
                        <div class="col-md-12">
                            <div class="property_list">
                                <div class="img_area list_img" style="min-width: 315px; max-width:315px;">
                                    <div class="sale_btn">@prop.Status</div>
                                    <div class="featured_btn">@prop.Type</div>
                                    <a href="@Url.Action("Detail", new { id = prop.Id })"><img src="@prop.AvatarPath" alt="@prop.AvatarName"></a>
                                    <div class="sale_amount">@prop.City</div>
                                </div>
                                <div class="list_type">
                                    <div class="property-text">
                                        <a href="@Url.Action("Detail", new { id = prop.Id })"><h5 class="property-title">@prop.Name</h5></a>
                                        <span><i class="fa fa-map-marker" aria-hidden="true"></i> @prop.Address</span>
                                        <div class="quantity">
                                            <div style="display: flex;width: 100%; flex-direction: row; flex-wrap: nowrap; padding: 0 10px">
                                                <div title="Diện Tích : @prop.AreaFormated m²" class="tooltip-ac" style="width: 100%; text-overflow:ellipsis; white-space:nowrap; overflow: hidden">Diện Tích : @prop.AreaFormated m²</div>
                                                <div title="Phòng Ngủ : @prop.NumberOfBedRoom" class="tooltip-ac" style="width: 100%; text-overflow:ellipsis; white-space:nowrap; overflow: hidden; display:@(@prop.NumberOfBedRoom == 0 ? "none" : "block")">Phòng Ngủ : @prop.NumberOfBedRoom</div>
                                                <div title="Phòng Tắm : @prop.NumberOfBathRoom" class="tooltip-ac" style="width: 100%; text-overflow:ellipsis; white-space:nowrap; overflow: hidden; display:@(@prop.NumberOfBathRoom == 0 ? "none" : "block")">Phòng Tắm : @prop.NumberOfBathRoom</div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="bed_area">
                                        <ul>
                                            <li>Giá: @prop.PriceFormated</li>
                                            <li style="float:right"><i class="fa fa-calendar"></i> @prop.CreatedOn.TimeAgo() &nbsp</li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        </div>
                    }
                </div>
                <!-- End Property list -->
                @{
                    if (ViewBag.TotalPages > 1)
                    {
                        routeValues["PageSize"] = ViewBag.PageSize;
                        routeValues["SortField"] = ViewBag.SortField;
                        Html.RenderAction("RenderPaging", "SiteClient",
                                    new
                                    {
                                        pageView = new _PageView
                                        {
                                            Action = action,
                                            Controller = controller,
                                            PageIndex = ViewBag.PageIndex,
                                            TotalPage = ViewBag.TotalPages,
                                            ShowPage = 5,
                                            RouteValues = routeValues,
                                            Prefix = searchPrefix
                                        }
                                    });
                    }
                }
            </div>
            <div class="col-md-2">
                <div class="featured_sidebar sidebar-widget">
                    <h4 class="widget-title">Nổi Bật</h4>
                    <div class="slide_featured">
                        @foreach (var property in Model.Featured)
                        {
                            <div class="item">
                                <div class="thumb">
                                    <div class="sidebar_img">
                                        <a href="@Url.Action("Detail", new { id = property.Id })"><img src="@property.AvatarPath" alt="@property.AvatarName"></a>
                                        <div class="sale_btn">@property.Type</div>
                                        <div class="quantity">
                                            <ul>
                                                <li><span>Diện Tính</span>@property.AreaFormated m²</li>
                                                @*<li style="display:@(property.NumberOfBedRoom == 0 ? "none" : "block");"><span>Phòng Ngủ</span>@property.NumberOfBedRoom</li>
                                                <li style="display:@(property.NumberOfBedRoom == 0 ? "none" : "block");"><span>Phòng Tắm</span>@property.NumberOfBedRoom</li>*@
                                            </ul>
                                        </div>
                                    </div>
                                    <div class="property-text">
                                        <a href="@Url.Action("Detail", new { id = property.Id })"><h6 class="property-title">@property.Name</h6></a>
                                        <div class="property_price">Giá: @property.PriceFormated</div>
                                    </div>
                                </div>
                            </div>
                        }
                    </div>
                </div>
                <div class="sidebar-widget">
                    <h4 class="widget-title">Bài Đăng Gần Đây</h4>
                    <ul class="recent-post">
                        @foreach (var post in ViewBag.RecentPosts)
                        {
                            <li>
                                <a href="@Url.Action("Detail", "Blog", new { id = post.Id })">@post.Name</a>
                                <span>@(((DateTimeOffset)post.CreatedOn).TimeAgo())<i class="fa fa-comments-o" aria-hidden="true"></i> @post.CommentCount bình luận</span>
                            </li>
                        }
                    </ul>
                </div>
            </div>
        </div>
    </div>
</section>
<!-- Property List End -->